FROM node:20-alpine3.20
EXPOSE 3000
WORKDIR .
COPY .next/standalone .next/standalone
COPY package.json next.config.mjs .
COPY public .next/standalone/apps/rays-dashboard/public
COPY .next/static .next/standalone/apps/rays-dashboard/.next/static

ARG FUNCTIONS_API_URL \
    BORROW_DB_READ_CONNECTION_STRING \
    CONTENTFUL_SPACE_ID \
    CONTENTFUL_ACCESS_TOKEN \
    CONTENTFUL_PREVIEW_ACCESS_TOKEN \
    CONFIG_URL \
    CONFIG_URL_RAYS \
    MIXPANEL_KEY \
    NEXT_PUBLIC_MIXPANEL_KEY \
    FUNCTIONS_API_URL \
    NEXT_TELEMETRY_DISABLED

ENV FUNCTIONS_API_URL=$FUNCTIONS_API_URL \
    BORROW_DB_READ_CONNECTION_STRING=$BORROW_DB_READ_CONNECTION_STRING \
    CONTENTFUL_SPACE_ID=$CONTENTFUL_SPACE_ID \
    CONTENTFUL_ACCESS_TOKEN=$CONTENTFUL_ACCESS_TOKEN \
    CONTENTFUL_PREVIEW_ACCESS_TOKEN=$CONTENTFUL_PREVIEW_ACCESS_TOKEN \
    CONFIG_URL=$CONFIG_URL \
    CONFIG_URL_RAYS=$CONFIG_URL_RAYS \
    MIXPANEL_KEY=$MIXPANEL_KEY \
    NEXT_PUBLIC_MIXPANEL_KEY=$NEXT_PUBLIC_MIXPANEL_KEY \
    FUNCTIONS_API_URL=$FUNCTIONS_API_URL \
    NEXT_TELEMETRY_DISABLED=$NEXT_TELEMETRY_DISABLED

CMD [ "node", ".next/standalone/apps/rays-dashboard/server.js" ]
