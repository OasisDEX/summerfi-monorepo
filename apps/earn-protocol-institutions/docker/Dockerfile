FROM node:22.7.0-alpine
RUN apk add --no-cache curl wget
EXPOSE 3000
WORKDIR .
COPY .next/standalone .next/standalone
COPY package.json next.config.ts .
COPY public .next/standalone/apps/earn-protocol-institutions/public
COPY .next/static .next/standalone/apps/earn-protocol-institutions/.next/static

ARG CONFIG_URL_EARN \
    EARN_MIXPANEL_KEY \
    SUBGRAPH_BASE \
    NEXT_PUBLIC_EARN_MIXPANEL_KEY \
    SDK_API_URL \
    FORECAST_API_URL \
    RECAPTCHA_SECRET_KEY \
    RPC_GATEWAY \
    NEXT_TELEMETRY_DISABLED \
    NEWSLETTER_API_KEY \
    NEWSLETTER_PUBLICATION_ID \
    NEWSLETTER_ENDPOINT \
    NEXT_PUBLIC_SHA \
    ENVIRONMENT_TAG \
    SECURE_PAGE_COOKIE_AUTH_TOKEN \
    ACCOUNT_KIT_API_KEY \
    FUNCTIONS_API_URL


ENV CONFIG_URL_EARN=$CONFIG_URL_EARN \
    EARN_MIXPANEL_KEY=$EARN_MIXPANEL_KEY \
    SUBGRAPH_BASE=$SUBGRAPH_BASE \
    NEXT_PUBLIC_EARN_MIXPANEL_KEY=$NEXT_PUBLIC_EARN_MIXPANEL_KEY \
    SDK_API_URL=$SDK_API_URL \
    FORECAST_API_URL=$FORECAST_API_URL \
    RECAPTCHA_SECRET_KEY=$RECAPTCHA_SECRET_KEY \
    RPC_GATEWAY=$RPC_GATEWAY \
    NEXT_TELEMETRY_DISABLED=$NEXT_TELEMETRY_DISABLED \
    NEWSLETTER_API_KEY=$NEWSLETTER_API_KEY \
    NEWSLETTER_PUBLICATION_ID=$NEWSLETTER_PUBLICATION_ID \
    NEWSLETTER_ENDPOINT=$NEWSLETTER_ENDPOINT \
    NEXT_PUBLIC_SHA=$NEXT_PUBLIC_SHA \
    ENVIRONMENT_TAG=$ENVIRONMENT_TAG \
    SECURE_PAGE_COOKIE_AUTH_TOKEN=$SECURE_PAGE_COOKIE_AUTH_TOKEN \
    ACCOUNT_KIT_API_KEY=$ACCOUNT_KIT_API_KEY \
    FUNCTIONS_API_URL=$FUNCTIONS_API_URL

CMD [ "node", "--max-old-space-size=6144", ".next/standalone/apps/earn-protocol-institutions/server.js" ]
