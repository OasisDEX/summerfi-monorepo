FROM node:23-alpine
EXPOSE 3000
WORKDIR .
COPY .next/standalone .next/standalone
COPY package.json next.config.ts .
COPY public .next/standalone/apps/earn-protocol/public
COPY .next/static .next/standalone/apps/earn-protocol/.next/static

ARG FUNCTIONS_API_URL \
    BORROW_DB_READ_CONNECTION_STRING \
    CONTENTFUL_SPACE_ID \
    CONTENTFUL_ACCESS_TOKEN \
    CONTENTFUL_PREVIEW_ACCESS_TOKEN \
    CONFIG_URL \
    CONFIG_URL_EARN \
    CONFIG_URL_RAYS \
    EARN_MIXPANEL_KEY \
    SUBGRAPH_BASE \
    NEXT_PUBLIC_EARN_MIXPANEL_KEY \
    SDK_API_URL \
    ACCOUNT_KIT_API_KEY \
    FORECAST_API_URL \
    NEXT_PUBLIC_TRANSAK_API_KEY \
    NEXT_PUBLIC_TRANSAK_ENVIRONMENT \
    TRANSAK_SECRET \
    EARN_PROTOCOL_DB_CONNECTION_STRING \
    EARN_PROTOCOL_JWT_SECRET \
    EARN_PROTOCOL_JWT_CHALLENGE_SECRET \
    RPC_GATEWAY \
    TRM_API_KEY \
    TALLY_API_KEY \
    NEXT_TELEMETRY_DISABLED \
    NEWSLETTER_API_KEY \
    NEWSLETTER_PUBLICATION_ID \
    NEWSLETTER_ENDPOINT \
    EARN_PROTOCOL_UPDATE_TABLES_AUTH_TOKEN \
    NEXT_PUBLIC_SHA \
    EARN_APP_URL


ENV FUNCTIONS_API_URL=$FUNCTIONS_API_URL \
    BORROW_DB_READ_CONNECTION_STRING=$BORROW_DB_READ_CONNECTION_STRING \
    CONTENTFUL_SPACE_ID=$CONTENTFUL_SPACE_ID \
    CONTENTFUL_ACCESS_TOKEN=$CONTENTFUL_ACCESS_TOKEN \
    CONTENTFUL_PREVIEW_ACCESS_TOKEN=$CONTENTFUL_PREVIEW_ACCESS_TOKEN \
    CONFIG_URL=$CONFIG_URL \
    CONFIG_URL_EARN=$CONFIG_URL_EARN \
    CONFIG_URL_RAYS=$CONFIG_URL_RAYS \
    EARN_MIXPANEL_KEY=$EARN_MIXPANEL_KEY \
    SUBGRAPH_BASE=$SUBGRAPH_BASE \
    NEXT_PUBLIC_EARN_MIXPANEL_KEY=$NEXT_PUBLIC_EARN_MIXPANEL_KEY \
    SDK_API_URL=$SDK_API_URL \
    ACCOUNT_KIT_API_KEY=$ACCOUNT_KIT_API_KEY \
    FORECAST_API_URL=$FORECAST_API_URL \
    NEXT_PUBLIC_TRANSAK_API_KEY=$NEXT_PUBLIC_TRANSAK_API_KEY \
    NEXT_PUBLIC_TRANSAK_ENVIRONMENT=$NEXT_PUBLIC_TRANSAK_ENVIRONMENT \
    TRANSAK_SECRET=$TRANSAK_SECRET \
    EARN_PROTOCOL_DB_CONNECTION_STRING=$EARN_PROTOCOL_DB_CONNECTION_STRING \
    EARN_PROTOCOL_JWT_SECRET=$EARN_PROTOCOL_JWT_SECRET \
    EARN_PROTOCOL_JWT_CHALLENGE_SECRET=$EARN_PROTOCOL_JWT_CHALLENGE_SECRET \
    RPC_GATEWAY=$RPC_GATEWAY \
    TRM_API_KEY=$TRM_API_KEY \
    TALLY_API_KEY=$TALLY_API_KEY \
    NEXT_TELEMETRY_DISABLED=$NEXT_TELEMETRY_DISABLED \
    NEWSLETTER_API_KEY=$NEWSLETTER_API_KEY \
    NEWSLETTER_PUBLICATION_ID=$NEWSLETTER_PUBLICATION_ID \
    NEWSLETTER_ENDPOINT=$NEWSLETTER_ENDPOINT \
    EARN_PROTOCOL_UPDATE_TABLES_AUTH_TOKEN=$EARN_PROTOCOL_UPDATE_TABLES_AUTH_TOKEN \
    NEXT_PUBLIC_SHA=$NEXT_PUBLIC_SHA \
    EARN_APP_URL=$EARN_APP_URL

CMD [ "node", ".next/standalone/apps/earn-protocol/server.js" ]
