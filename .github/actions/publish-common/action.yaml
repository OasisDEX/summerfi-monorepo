name: Publish Common Package
description: Publish the common package to NPM
inputs:
  NPM_ACCESS_TOKEN:
    description: 'The NPM access token'
    required: true
    default: ''

runs:
  using: 'composite'
  steps:
  - uses: actions/setup-node@v4
    with:
      node-version: '20'
      registry-url: 'https://registry.npmjs.org'
      corepack: true

  - name: Install pnpm
    shell: bash
    run: corepack enable && corepack prepare pnpm@latest --activate

  - name: Install dependencies with pnpm
    shell: bash
    run: pnpm i

  - name: Build with pnpm
    shell: bash
    run: pnpm build

  - name: Publish package with pnpm
    shell: bash
    run: pnpm publish:npm
    working-directory: sdk/sdk-common
    env:
      NPM_ACCESS_TOKEN: ${{ inputs.NPM_ACCESS_TOKEN }}
