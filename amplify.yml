version: 1
frontend:
  phases:
    preBuild:
      commands:
        - sudo yum update -y
        - yum install epel-release -y
        - sudo yum update -y
        - yum install -y openvpn openvpn-systemd-resolved
        - echo 'Configuring the VPN...'
        - echo "${{ secrets.VPN_CONFIG }}" > vpn-config.ovpn
        - echo "${{ secrets.VPN_USERNAME }}" > vpn-credentials.txt
        - echo "${{ secrets.VPN_PASSWORD }}" >> vpn-credentials.txt
        - echo 'Connecting to the VPN...'
        - sudo openvpn --config vpn-config.ovpn --auth-user-pass vpn-credentials.txt --daemon
        - sleep 5
        - npx pnpm install
    build:
      commands:
        - npx pnpm build
  artifacts:
    baseDirectory: apps/earn-protocol/.next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - /**/*/node_modules/**/*
